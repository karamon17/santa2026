# Тайный Санта: бот-викторина для владельца XC40

Телеграм-бот задаёт 26 вопросов про Volvo XC40, начисляет баллы за правильные ответы и открывает подборки советов на 5, 10 и 15 баллах. После первого круга вопросы с ошибками повторяются, пока пользователь не наберёт 15 очков.

## Возможности
- Приветствие и вводное сообщение с кнопкой «Поехали» (два шага).
- 26 вопросов с вариантами ответов A–D в виде inline-кнопок.
- 1 балл за каждый правильный ответ, показ правильного ответа при ошибке.
- Повтор вопросов, на которые пользователь ответил неверно, после первого прохода.
- Автоматическая выдача подборок:
  - 5 баллов — советы по безопасности;
  - 10 баллов — лайфхаки по парковке;
  - 15 баллов — вдохновляющие фразы и финал игры.
- Хранение состояния пользователей в памяти без базы данных.
- Поддержка вебхука через FastAPI и локальный режим polling для отладки.

## Требования
- Python 3.11+
- Telegram Bot API токен в переменной окружения `TELEGRAM_TOKEN` или в файле `.env`.
- (Опционально) настройте `TARGET_SCORE` в `.env`, если хотите изменить цель по баллам.

Установите зависимости:

```bash
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

## Запуск через вебхук
1. Поднимите приложение:
   ```bash
cp .env .env.local  # создайте приватную копию и заполните TELEGRAM_TOKEN
source .env.local
uvicorn app.server:app --host 0.0.0.0 --port 8000
   ```
2. В BotFather укажите вебхук на `https://<ваш-домен>/webhook` (совпадает с `WEBHOOK_URL`).

## Локальный запуск (polling)
Для отладки без вебхука запустите:

```bash
source .env.local
python main.py
```

## Структура состояния
Состояние игрока хранится в памяти процесса:
- `score` — текущие баллы;
- `current_index` — номер следующего вопроса из основного списка;
- `incorrect_queue` — очередь вопросов с ошибками;
- флаги для отправки подборок на 5/10/15 баллах.

## Примечания
- Токен бота не хранится в коде, укажите его через `TELEGRAM_TOKEN`.
- При отсутствии публичного URL используйте polling.
- Данные стираются при перезапуске процесса, потому что хранятся в памяти.
